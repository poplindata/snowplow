/*
 * Copyright (c) 2012-2020 Snowplow Analytics Ltd. All rights reserved.
 *
 * This program is licensed to you under the Apache License Version 2.0,
 * and you may not use this file except in compliance with the Apache License Version 2.0.
 * You may obtain a copy of the Apache License Version 2.0 at
 * http://www.apache.org/licenses/LICENSE-2.0.
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the Apache License Version 2.0 is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the Apache License Version 2.0 for the specific language governing permissions and
 * limitations there under.
 */
package com.snowplowanalytics.snowplow.enrich.spark
package bad

import org.specs2.mutable.Specification

object BadTrackerCfLinesSpec {
  val lines = EnrichJobSpec.Lines(
    "2012-05-24  00:08:40  LHR5  3397  74.125.17.210 GET d3gs014xn8p70.cloudfront.net  /ice.png  200 http://www.psychicbazaar.com/oracles/119-psycards-book-and-deck-starter-pack.html Mozilla/5.0%20(Linux;%20U;%20Android%202.3.4;%20generic)%20AppleWebKit/535.1%20(KHTML,%20like%20Gecko;%20Google%20Web%20Preview)%20Version/4.0%20Mobile%20Safari/535.1  e=pv&p=mobile&page=Psycards%2520book%2520and%2520deck%2520starter%2520pack%2520-%2520Psychic%2520Bazaar&tid=721410&uid=3798cdce0493133e&vid=1&lang=en&refr=http%253A%252F%252Fwww.google.com%252Fm%252Fsearch&res=640x960&cookie=1",
    "2012-05-24  00:06:42  LHR5  3402  213.52.50.8  GET d3gs014xn8p70.cloudfront.net  /ice.png  200 http://www.psychicbazaar.com/oracles/119-psycards-book-and-deck-starter-pack.html Mozilla/5.0%20(iPhone;%20CPU%20iPhone%20OS%205_1_1%20like%20Mac%20OS%20X)%20AppleWebKit/534.46%20(KHTML,%20like%20Gecko)%20Version/5.1%20Mobile/9B206%20Safari/7534.48.3  e=lol&page=Psycards%2520book%2520and%2520deck%2520starter%2520pack%2520-%2520Psychic%2520Bazaar&tid=019539&uid=e7bccbb647296c98&vid=a&p=web&aid=CFe23a&fp=1906624389&tz=Europe%2FLondon&cd=24&lang=en-us&refr=http%253A%252F%252Fwww.google.com%252Fsearch%253Fhl%253Den%2526q%253Dthe%252Bpsycard%252Bstory%2526oq%253Dthe%252Bpsycard%252Bstory%2526aq%253Df%2526aqi%253D%2526aql%253D%2526gs_l%253Dmobile-gws-serp.12...0.0.0.6358.0.0.0.0.0.0.0.0..0.0...0.0.JrNbKlRgHbQ%2526mvs%253D0&f_pdf=0&f_qt=1&f_realp=0&f_wma=1&f_dir=0&f_fla=1&f_java=0&f_gears=1&f_ag=0&res=320x480&cookie=1",
    "2012-05-24  00:06:42  LHR5  3402  90.194.12.51  GET d3gs014xn8p70.cloudfront.net  /ice.png  200 http://www.psychicbazaar.com/oracles/119-psycards-book-and-deck-starter-pack.html Mozilla/5.0%20(iPhone;%20CPU%20iPhone%20OS%205_1_1%20like%20Mac%20OS%20X)%20AppleWebKit/534.46%20(KHTML,%20like%20Gecko)%20Version/5.1%20Mobile/9B206%20Safari/7534.48.3  e=lol&ue_px=am9obitzbWl0aA&page=Psycards%2520book%2520and%2520deck%2520starter%2520pack%2520-%2520Psychic%2520Bazaar&tid=019539&uid=e7bccbb647296c98&vid=a&p=web&aid=CFe23a&fp=1906624389&tz=Europe%2FLondon&cd=24&lang=en-us&refr=http%253A%252F%252Fwww.google.com%252Fsearch%253Fhl%253Den%2526q%253Dthe%252Bpsycard%252Bstory%2526oq%253Dthe%252Bpsycard%252Bstory%2526aq%253Df%2526aqi%253D%2526aql%253D%2526gs_l%253Dmobile-gws-serp.12...0.0.0.6358.0.0.0.0.0.0.0.0..0.0...0.0.JrNbKlRgHbQ%2526mvs%253D0&f_pdf=0&f_qt=1&f_realp=0&f_wma=1&f_dir=0&f_fla=1&f_java=0&f_gears=1&f_ag=0&res=320x480&cookie=1"
  )
  val expected = List(
    s"""{"schema":"iglu:com.snowplowanalytics.snowplow.badrows/enrichment_failures/jsonschema/1-0-0","data":{"processor":{"artifact":"spark","version":"${generated.BuildInfo.version}"},"failure":{"timestamp":"2019-11-22T09:37:21.643Z","messages":[{"enrichment":null,"message":{"field":"p","value":"mobile","expectation":"not recognized as a tracking platform"}}]},"payload":{"enriched":{"app_id":null,"platform":null,"etl_tstamp":"2001-09-09 01:46:40.000","collector_tstamp":"2012-05-24 00:08:40.000","dvce_created_tstamp":null,"event":"page_view","event_id":"ff30c659-682a-4bf6-a378-4081d3c34c76","txn_id":"721410","name_tracker":null,"v_tracker":null,"v_collector":"cloudfront","v_etl":"spark-${generated.BuildInfo.version}-common-1.0.0","user_id":"3798cdce0493133e","user_ipaddress":"74.125.17.210","user_fingerprint":null,"domain_userid":null,"domain_sessionidx":1,"network_userid":null,"geo_country":null,"geo_region":null,"geo_city":null,"geo_zipcode":null,"geo_latitude":0.0,"geo_longitude":0.0,"geo_region_name":null,"ip_isp":null,"ip_organization":null,"ip_domain":null,"ip_netspeed":null,"page_url":"http://www.psychicbazaar.com/oracles/119-psycards-book-and-deck-starter-pack.html","page_title":"Psycards book and deck starter pack - Psychic Bazaar","page_referrer":"http://www.google.com/m/search","page_urlscheme":"http","page_urlhost":"www.psychicbazaar.com","page_urlport":80,"page_urlpath":"/oracles/119-psycards-book-and-deck-starter-pack.html","page_urlquery":null,"page_urlfragment":null,"refr_urlscheme":"http","refr_urlhost":"www.google.com","refr_urlport":80,"refr_urlpath":"/m/search","refr_urlquery":null,"refr_urlfragment":null,"refr_medium":"search","refr_source":"Google","refr_term":null,"mkt_medium":null,"mkt_source":null,"mkt_term":null,"mkt_content":null,"mkt_campaign":null,"contexts":null,"se_category":null,"se_action":null,"se_label":null,"se_property":null,"se_value":null,"unstruct_event":null,"tr_orderid":null,"tr_affiliation":null,"tr_total":null,"tr_tax":null,"tr_shipping":null,"tr_city":null,"tr_state":null,"tr_country":null,"ti_orderid":null,"ti_sku":null,"ti_name":null,"ti_category":null,"ti_price":null,"ti_quantity":0,"pp_xoffset_min":0,"pp_xoffset_max":0,"pp_yoffset_min":0,"pp_yoffset_max":0,"useragent":"Mozilla/5.0 (Linux; U; Android 2.3.4; generic) AppleWebKit/535.1 (KHTML, like Gecko; Google Web Preview) Version/4.0 Mobile Safari/535.1","br_name":"Safari 4","br_family":"Safari","br_version":"4.0","br_type":"Browser","br_renderengine":"WEBKIT","br_lang":"en","br_features_pdf":0,"br_features_flash":0,"br_features_java":0,"br_features_director":0,"br_features_quicktime":0,"br_features_realplayer":0,"br_features_windowsmedia":0,"br_features_gears":0,"br_features_silverlight":0,"br_cookies":1,"br_colordepth":null,"br_viewwidth":0,"br_viewheight":0,"os_name":"Android 2.x","os_family":"Android","os_manufacturer":"Google Inc.","os_timezone":null,"dvce_type":"Mobile","dvce_ismobile":1,"dvce_screenwidth":640,"dvce_screenheight":960,"doc_charset":null,"doc_width":0,"doc_height":0,"tr_currency":null,"tr_total_base":null,"tr_tax_base":null,"tr_shipping_base":null,"ti_currency":null,"ti_price_base":null,"base_currency":null,"geo_timezone":null,"mkt_clickid":null,"mkt_network":null,"etl_tags":null,"dvce_sent_tstamp":null,"refr_domain_userid":null,"refr_dvce_tstamp":null,"derived_contexts":"{\\"schema\\":\\"iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-1\\",\\"data\\":[{\\"schema\\":\\"iglu:com.snowplowanalytics.snowplow/ua_parser_context/jsonschema/1-0-0\\",\\"data\\":{\\"useragentFamily\\":\\"Android\\",\\"useragentMajor\\":\\"2\\",\\"useragentMinor\\":\\"3\\",\\"useragentPatch\\":\\"4\\",\\"useragentVersion\\":\\"Android 2.3.4\\",\\"osFamily\\":\\"Android\\",\\"osMajor\\":\\"2\\",\\"osMinor\\":\\"3\\",\\"osPatch\\":\\"4\\",\\"osPatchMinor\\":null,\\"osVersion\\":\\"Android 2.3.4\\",\\"deviceFamily\\":\\"Generic Smartphone\\"}}]}","domain_sessionid":null,"derived_tstamp":"2012-05-24 00:08:40.000","event_vendor":"com.snowplowanalytics.snowplow","event_name":"page_view","event_format":"jsonschema","event_version":"1-0-0","event_fingerprint":"cec47b1756b7a087c065be1db80f9063","true_tstamp":null},"raw":{"vendor":"com.snowplowanalytics.snowplow","version":"tp1","parameters":{"e":"pv","vid":"1","refr":"http://www.google.com/m/search","page":"Psycards book and deck starter pack - Psychic Bazaar","res":"640x960","cookie":"1","p":"mobile","uid":"3798cdce0493133e","lang":"en","tid":"721410"},"contentType":null,"loaderName":"cloudfront","encoding":"UTF-8","hostname":null,"timestamp":"2012-05-24T00:08:40.000Z","ipAddress":"74.125.17.210","useragent":"Mozilla/5.0%20(Linux;%20U;%20Android%202.3.4;%20generic)%20AppleWebKit/535.1%20(KHTML,%20like%20Gecko;%20Google%20Web%20Preview)%20Version/4.0%20Mobile%20Safari/535.1","refererUri":"http://www.psychicbazaar.com/oracles/119-psycards-book-and-deck-starter-pack.html","headers":[],"userId":null}}}}""",
    s"""{"schema":"iglu:com.snowplowanalytics.snowplow.badrows/enrichment_failures/jsonschema/1-0-0","data":{"processor":{"artifact":"spark","version":"${generated.BuildInfo.version}"},"failure":{"timestamp":"2019-11-22T09:37:21.643Z","messages":[{"enrichment":null,"message":{"field":"event","value":null,"expectation":"unrecognized"}},{"enrichment":null,"message":{"field":"vid","value":"a","expectation":"cannot be converted to java.lang.Integer"}},{"enrichment":null,"message":{"field":"e","value":"lol","expectation":"not recognized as an event type"}}]},"payload":{"enriched":{"app_id":"CFe23a","platform":"web","etl_tstamp":"2001-09-09 01:46:40.000","collector_tstamp":"2012-05-24 00:06:42.000","dvce_created_tstamp":null,"event":null,"event_id":"ff30c659-682a-4bf6-a378-4081d3c34c76","txn_id":"019539","name_tracker":null,"v_tracker":null,"v_collector":"cloudfront","v_etl":"spark-${generated.BuildInfo.version}-common-1.0.0","user_id":"e7bccbb647296c98","user_ipaddress":"213.52.50.8","user_fingerprint":"1906624389","domain_userid":null,"domain_sessionidx":0,"network_userid":null,"geo_country":null,"geo_region":null,"geo_city":null,"geo_zipcode":null,"geo_latitude":0.0,"geo_longitude":0.0,"geo_region_name":null,"ip_isp":null,"ip_organization":null,"ip_domain":null,"ip_netspeed":null,"page_url":"http://www.psychicbazaar.com/oracles/119-psycards-book-and-deck-starter-pack.html","page_title":"Psycards book and deck starter pack - Psychic Bazaar","page_referrer":"http://www.google.com/search?hl=en&q=the+psycard+story&oq=the+psycard+story&aq=f&aqi=&aql=&gs_l=mobile-gws-serp.12...0.0.0.6358.0.0.0.0.0.0.0.0..0.0...0.0.JrNbKlRgHbQ&mvs=0","page_urlscheme":"http","page_urlhost":"www.psychicbazaar.com","page_urlport":80,"page_urlpath":"/oracles/119-psycards-book-and-deck-starter-pack.html","page_urlquery":null,"page_urlfragment":null,"refr_urlscheme":"http","refr_urlhost":"www.google.com","refr_urlport":80,"refr_urlpath":"/search","refr_urlquery":"hl=en&q=the+psycard+story&oq=the+psycard+story&aq=f&aqi=&aql=&gs_l=mobile-gws-serp.12...0.0.0.6358.0.0.0.0.0.0.0.0..0.0...0.0.JrNbKlRgHbQ&mvs=0","refr_urlfragment":null,"refr_medium":"search","refr_source":"Google","refr_term":"the psycard story","mkt_medium":null,"mkt_source":null,"mkt_term":null,"mkt_content":null,"mkt_campaign":null,"contexts":null,"se_category":null,"se_action":null,"se_label":null,"se_property":null,"se_value":null,"unstruct_event":null,"tr_orderid":null,"tr_affiliation":null,"tr_total":null,"tr_tax":null,"tr_shipping":null,"tr_city":null,"tr_state":null,"tr_country":null,"ti_orderid":null,"ti_sku":null,"ti_name":null,"ti_category":null,"ti_price":null,"ti_quantity":0,"pp_xoffset_min":0,"pp_xoffset_max":0,"pp_yoffset_min":0,"pp_yoffset_max":0,"useragent":"Mozilla/5.0 (iPhone; CPU iPhone OS 5_1_1 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9B206 Safari/7534.48.3","br_name":"Mobile Safari","br_family":"Safari","br_version":"5.1","br_type":"Browser (mobile)","br_renderengine":"WEBKIT","br_lang":"en-us","br_features_pdf":0,"br_features_flash":1,"br_features_java":0,"br_features_director":0,"br_features_quicktime":1,"br_features_realplayer":0,"br_features_windowsmedia":1,"br_features_gears":1,"br_features_silverlight":0,"br_cookies":1,"br_colordepth":"24","br_viewwidth":0,"br_viewheight":0,"os_name":"iOS 5 (iPhone)","os_family":"iOS","os_manufacturer":"Apple Inc.","os_timezone":"Europe/London","dvce_type":"Mobile","dvce_ismobile":1,"dvce_screenwidth":320,"dvce_screenheight":480,"doc_charset":null,"doc_width":0,"doc_height":0,"tr_currency":null,"tr_total_base":null,"tr_tax_base":null,"tr_shipping_base":null,"ti_currency":null,"ti_price_base":null,"base_currency":null,"geo_timezone":null,"mkt_clickid":null,"mkt_network":null,"etl_tags":null,"dvce_sent_tstamp":null,"refr_domain_userid":null,"refr_dvce_tstamp":null,"derived_contexts":"{\\"schema\\":\\"iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-1\\",\\"data\\":[{\\"schema\\":\\"iglu:com.snowplowanalytics.snowplow/ua_parser_context/jsonschema/1-0-0\\",\\"data\\":{\\"useragentFamily\\":\\"Mobile Safari\\",\\"useragentMajor\\":\\"5\\",\\"useragentMinor\\":\\"1\\",\\"useragentPatch\\":null,\\"useragentVersion\\":\\"Mobile Safari 5.1\\",\\"osFamily\\":\\"iOS\\",\\"osMajor\\":\\"5\\",\\"osMinor\\":\\"1\\",\\"osPatch\\":\\"1\\",\\"osPatchMinor\\":null,\\"osVersion\\":\\"iOS 5.1.1\\",\\"deviceFamily\\":\\"iPhone\\"}}]}","domain_sessionid":null,"derived_tstamp":"2012-05-24 00:06:42.000","event_vendor":null,"event_name":null,"event_format":null,"event_version":null,"event_fingerprint":"3803aa5124220f57b45e156872fb969e","true_tstamp":null},"raw":{"vendor":"com.snowplowanalytics.snowplow","version":"tp1","parameters":{"e":"lol","f_qt":"1","vid":"a","f_ag":"0","refr":"http://www.google.com/search?hl=en&q=the+psycard+story&oq=the+psycard+story&aq=f&aqi=&aql=&gs_l=mobile-gws-serp.12...0.0.0.6358.0.0.0.0.0.0.0.0..0.0...0.0.JrNbKlRgHbQ&mvs=0","aid":"CFe23a","f_dir":"0","cd":"24","page":"Psycards book and deck starter pack - Psychic Bazaar","tz":"Europe/London","f_pdf":"0","f_java":"0","f_realp":"0","fp":"1906624389","res":"320x480","f_fla":"1","cookie":"1","p":"web","uid":"e7bccbb647296c98","f_gears":"1","lang":"en-us","tid":"019539","f_wma":"1"},"contentType":null,"loaderName":"cloudfront","encoding":"UTF-8","hostname":null,"timestamp":"2012-05-24T00:06:42.000Z","ipAddress":"213.52.50.8","useragent":"Mozilla/5.0%20(iPhone;%20CPU%20iPhone%20OS%205_1_1%20like%20Mac%20OS%20X)%20AppleWebKit/534.46%20(KHTML,%20like%20Gecko)%20Version/5.1%20Mobile/9B206%20Safari/7534.48.3","refererUri":"http://www.psychicbazaar.com/oracles/119-psycards-book-and-deck-starter-pack.html","headers":[],"userId":null}}}}""",
    s"""{"schema":"iglu:com.snowplowanalytics.snowplow.badrows/enrichment_failures/jsonschema/1-0-0","data":{"processor":{"artifact":"spark","version":"${generated.BuildInfo.version}"},"failure":{"timestamp":"2019-11-22T09:37:21.643Z","messages":[{"enrichment":null,"message":{"field":"event","value":null,"expectation":"unrecognized"}},{"enrichment":null,"message":{"field":"ue_px","value":"am9obitzbWl0aA","expectation":"invalid json: expected json value got 'john+s...' (line 1, column 1)"}},{"enrichment":null,"message":{"field":"vid","value":"a","expectation":"cannot be converted to java.lang.Integer"}},{"enrichment":null,"message":{"field":"e","value":"lol","expectation":"not recognized as an event type"}}]},"payload":{"enriched":{"app_id":"CFe23a","platform":"web","etl_tstamp":"2001-09-09 01:46:40.000","collector_tstamp":"2012-05-24 00:06:42.000","dvce_created_tstamp":null,"event":null,"event_id":"ff30c659-682a-4bf6-a378-4081d3c34c76","txn_id":"019539","name_tracker":null,"v_tracker":null,"v_collector":"cloudfront","v_etl":"spark-${generated.BuildInfo.version}-common-1.0.0","user_id":"e7bccbb647296c98","user_ipaddress":"90.194.12.51","user_fingerprint":"1906624389","domain_userid":null,"domain_sessionidx":0,"network_userid":null,"geo_country":null,"geo_region":null,"geo_city":null,"geo_zipcode":null,"geo_latitude":0.0,"geo_longitude":0.0,"geo_region_name":null,"ip_isp":null,"ip_organization":null,"ip_domain":null,"ip_netspeed":null,"page_url":"http://www.psychicbazaar.com/oracles/119-psycards-book-and-deck-starter-pack.html","page_title":"Psycards book and deck starter pack - Psychic Bazaar","page_referrer":"http://www.google.com/search?hl=en&q=the+psycard+story&oq=the+psycard+story&aq=f&aqi=&aql=&gs_l=mobile-gws-serp.12...0.0.0.6358.0.0.0.0.0.0.0.0..0.0...0.0.JrNbKlRgHbQ&mvs=0","page_urlscheme":"http","page_urlhost":"www.psychicbazaar.com","page_urlport":80,"page_urlpath":"/oracles/119-psycards-book-and-deck-starter-pack.html","page_urlquery":null,"page_urlfragment":null,"refr_urlscheme":"http","refr_urlhost":"www.google.com","refr_urlport":80,"refr_urlpath":"/search","refr_urlquery":"hl=en&q=the+psycard+story&oq=the+psycard+story&aq=f&aqi=&aql=&gs_l=mobile-gws-serp.12...0.0.0.6358.0.0.0.0.0.0.0.0..0.0...0.0.JrNbKlRgHbQ&mvs=0","refr_urlfragment":null,"refr_medium":"search","refr_source":"Google","refr_term":"the psycard story","mkt_medium":null,"mkt_source":null,"mkt_term":null,"mkt_content":null,"mkt_campaign":null,"contexts":null,"se_category":null,"se_action":null,"se_label":null,"se_property":null,"se_value":null,"unstruct_event":null,"tr_orderid":null,"tr_affiliation":null,"tr_total":null,"tr_tax":null,"tr_shipping":null,"tr_city":null,"tr_state":null,"tr_country":null,"ti_orderid":null,"ti_sku":null,"ti_name":null,"ti_category":null,"ti_price":null,"ti_quantity":0,"pp_xoffset_min":0,"pp_xoffset_max":0,"pp_yoffset_min":0,"pp_yoffset_max":0,"useragent":"Mozilla/5.0 (iPhone; CPU iPhone OS 5_1_1 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9B206 Safari/7534.48.3","br_name":"Mobile Safari","br_family":"Safari","br_version":"5.1","br_type":"Browser (mobile)","br_renderengine":"WEBKIT","br_lang":"en-us","br_features_pdf":0,"br_features_flash":1,"br_features_java":0,"br_features_director":0,"br_features_quicktime":1,"br_features_realplayer":0,"br_features_windowsmedia":1,"br_features_gears":1,"br_features_silverlight":0,"br_cookies":1,"br_colordepth":"24","br_viewwidth":0,"br_viewheight":0,"os_name":"iOS 5 (iPhone)","os_family":"iOS","os_manufacturer":"Apple Inc.","os_timezone":"Europe/London","dvce_type":"Mobile","dvce_ismobile":1,"dvce_screenwidth":320,"dvce_screenheight":480,"doc_charset":null,"doc_width":0,"doc_height":0,"tr_currency":null,"tr_total_base":null,"tr_tax_base":null,"tr_shipping_base":null,"ti_currency":null,"ti_price_base":null,"base_currency":null,"geo_timezone":null,"mkt_clickid":null,"mkt_network":null,"etl_tags":null,"dvce_sent_tstamp":null,"refr_domain_userid":null,"refr_dvce_tstamp":null,"derived_contexts":"{\\"schema\\":\\"iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-1\\",\\"data\\":[{\\"schema\\":\\"iglu:com.snowplowanalytics.snowplow/ua_parser_context/jsonschema/1-0-0\\",\\"data\\":{\\"useragentFamily\\":\\"Mobile Safari\\",\\"useragentMajor\\":\\"5\\",\\"useragentMinor\\":\\"1\\",\\"useragentPatch\\":null,\\"useragentVersion\\":\\"Mobile Safari 5.1\\",\\"osFamily\\":\\"iOS\\",\\"osMajor\\":\\"5\\",\\"osMinor\\":\\"1\\",\\"osPatch\\":\\"1\\",\\"osPatchMinor\\":null,\\"osVersion\\":\\"iOS 5.1.1\\",\\"deviceFamily\\":\\"iPhone\\"}}]}","domain_sessionid":null,"derived_tstamp":"2012-05-24 00:06:42.000","event_vendor":null,"event_name":null,"event_format":null,"event_version":null,"event_fingerprint":"6d4a42cf2925d604d342b14f8993fb87","true_tstamp":null},"raw":{"vendor":"com.snowplowanalytics.snowplow","version":"tp1","parameters":{"e":"lol","f_qt":"1","vid":"a","f_ag":"0","refr":"http://www.google.com/search?hl=en&q=the+psycard+story&oq=the+psycard+story&aq=f&aqi=&aql=&gs_l=mobile-gws-serp.12...0.0.0.6358.0.0.0.0.0.0.0.0..0.0...0.0.JrNbKlRgHbQ&mvs=0","aid":"CFe23a","f_dir":"0","cd":"24","page":"Psycards book and deck starter pack - Psychic Bazaar","tz":"Europe/London","f_pdf":"0","f_java":"0","f_realp":"0","fp":"1906624389","res":"320x480","f_fla":"1","cookie":"1","p":"web","uid":"e7bccbb647296c98","f_gears":"1","lang":"en-us","tid":"019539","ue_px":"am9obitzbWl0aA","f_wma":"1"},"contentType":null,"loaderName":"cloudfront","encoding":"UTF-8","hostname":null,"timestamp":"2012-05-24T00:06:42.000Z","ipAddress":"90.194.12.51","useragent":"Mozilla/5.0%20(iPhone;%20CPU%20iPhone%20OS%205_1_1%20like%20Mac%20OS%20X)%20AppleWebKit/534.46%20(KHTML,%20like%20Gecko)%20Version/5.1%20Mobile/9B206%20Safari/7534.48.3","refererUri":"http://www.psychicbazaar.com/oracles/119-psycards-book-and-deck-starter-pack.html","headers":[],"userId":null}}}}"""
  )
}

/** CloudFront-format rows which contain "bad data" from the tracker. */
class BadTrackerCfLinesSpec extends Specification with EnrichJobSpec {
  import EnrichJobSpec._
  override def appName = "bad-tracker-cf-lines"
  sequential
  "A job which processes input lines containing corrupted data from the tracker" should {
    runEnrichJob(BadTrackerCfLinesSpec.lines, "cloudfront", "1", false, List("geo"))

    "write bad row JSONs, each containing an input line and the errors" in {
      val Some(bads) = readPartFile(dirs.badRows)
      bads.map(removeTstamp).map(EnrichJobSpec.removeId) must_== BadTrackerCfLinesSpec.expected
    }

    "not write any events" in {
      dirs.output must beEmptyDir
    }
  }
}
